<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>a-planta Timer | Учет рабочего времени</title>
    <style>
        /* Базовые стили и сброс */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: rgb(178, 223, 219);
            --primary-dark: rgb(148, 203, 198);
            --text-color: #333;
            --light-gray: #f5f5f7;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            color: var(--text-color);
            line-height: 1.6;
            background-color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            min-height: 90vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Экран аутентификации */
        .auth-screen {
            text-align: center;
            max-width: 400px;
            width: 100%;
            padding: 40px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .logo {
            margin-bottom: 20px;
        }

        .logo svg {
            margin-bottom: 15px;
        }

        .logo h1 {
            font-weight: 600;
            font-size: 2.5rem;
            color: var(--primary-color);
        }

        .tagline {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .auth-form {
            margin-bottom: 30px;
        }

        .auth-form input {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            text-align: center;
            letter-spacing: 1px;
        }

        .auth-form button {
            width: 100%;
            padding: 15px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .auth-form button:hover {
            background: var(--primary-dark);
        }

        .features {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 40px;
        }

        .feature {
            padding: 20px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            text-align: left;
        }

        .feature h3 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Основное приложение */
        .app-container {
            width: 100%;
            display: none;
            flex-direction: column;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            padding: 8px 15px;
            background: transparent;
            color: #666;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: var(--light-gray);
        }

        .home-btn {
            padding: 8px 15px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .home-btn:hover {
            background: var(--primary-dark);
        }

        .main-content {
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        section {
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            flex: 1;
        }

        h2 {
            margin-bottom: 20px;
            font-weight: 600;
            color: #444;
        }

        /* Таймер */
        .timer-card {
            text-align: center;
            padding: 30px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            margin-bottom: 30px;
        }

        .timer-display {
            font-size: 3.5rem;
            font-weight: 200;
            font-variant-numeric: tabular-nums;
            margin-bottom: 30px;
            color: #444;
        }

        .timer-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: white;
            color: var(--text-color);
            border: 1px solid #ddd;
        }

        .btn-secondary:hover {
            background: var(--light-gray);
        }

        /* Статистика */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .stat-card {
            padding: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-card span {
            font-size: 1.8rem;
            font-weight: 300;
            color: #444;
        }

        /* Настройки ставки */
        .rate-card {
            display: flex;
            gap: 15px;
        }

        .rate-card input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .rate-card button {
            white-space: nowrap;
        }

        /* Навигация приложения */
        .app-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding: 20px 0;
        }

        .nav-btn {
            flex-direction: column;
            padding: 15px;
            font-size: 0.8rem;
            background: var(--light-gray);
        }

        .nav-btn:hover {
            background: #e9e9e9;
        }

        /* История */
        .history-filters {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .history-filters input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
        }

        .history-filters button {
            white-space: nowrap;
        }

        .history-list {
            margin-bottom: 30px;
        }

        .history-item {
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr 1fr;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .history-stats {
            padding: 20px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }

        /* Синхронизация */
        .sync-section {
            padding: 20px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        .sync-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* Утилиты */
        .hidden {
            display: none;
        }

        /* Адаптивность */
        @media (max-width: 768px) {
            .timer-display {
                font-size: 2.5rem;
            }
            
            .timer-controls {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .rate-card {
                flex-direction: column;
            }
            
            .app-nav {
                flex-wrap: wrap;
            }
            
            .history-item {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .history-filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .auth-screen {
                padding: 20px;
            }
            
            .navbar {
                flex-direction: column;
                gap: 15px;
            }
            
            .sync-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Экран аутентификации -->
        <div class="auth-screen" id="authScreen">
            <div class="logo">
                <svg width="50" height="50" viewBox="0 0 50 50">
                    <circle cx="25" cy="25" r="20" fill="rgb(178, 223, 219)" />
                    <text x="25" y="32" font-family="Arial" font-size="20" text-anchor="middle" fill="white">a</text>
                </svg>
                <h1>a-planta Timer</h1>
            </div>
            <p class="tagline">Учет рабочего времени и заработка в лаборатории "А-ПЛАНТА"</p>
            
            <div class="auth-form">
                <input type="password" id="passwordInput" placeholder="Введите пароль">
                <button onclick="login()">Войти в приложение</button>
            </div>
            
            <div class="features">
                <div class="feature">
                    <h3>📊 Отслеживание времени</h3>
                    <p>Фиксируйте начало и конец рабочего дня</p>
                </div>
                <div class="feature">
                    <h3>💸 Расчет заработка</h3>
                    <p>Автоматический расчет дохода по часам</p>
                </div>
                <div class="feature">
                    <h3>📈 Статистика и история</h3>
                    <p>Анализируйте свою продуктивность с помощью графиков</p>
                </div>
                <div class="feature">
                    <h3>☁️ Синхронизация</h3>
                    <p>Работайте с нескольких устройств с синхронизацией данных</p>
                </div>
            </div>
        </div>

        <!-- Основной экран приложения (изначально скрыт) -->
        <div class="app-container" id="appContainer">
            <!-- Навигация -->
            <nav class="navbar">
                <div class="nav-brand">
                    <svg width="30" height="30" viewBox="0 0 50 50">
                        <circle cx="25" cy="25" r="20" fill="rgb(178, 223, 219)" />
                        <text x="25" y="32" font-family="Arial" font-size="20" text-anchor="middle" fill="white">a</text>
                    </svg>
                    <span>a-planta Timer</span>
                </div>
                <div class="nav-user">
                    <button class="home-btn" onclick="goToHome()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        На главную
                    </button>
                    <button class="logout-btn" onclick="logout()">Выйти</button>
                </div>
            </nav>

            <!-- Основной контент -->
            <main class="main-content">
                <!-- Экран таймера -->
                <section class="timer-section" id="timerSection">
                    <h2>Текущий рабочий сеанс</h2>
                    <div class="timer-card">
                        <div class="timer-display">
                            <span id="currentTimer">00:00:00</span>
                        </div>
                        <div class="timer-controls">
                            <button id="startTimer" class="btn-primary" onclick="startTimer()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polygon points="10,8 16,12 10,16"></polygon>
                                </svg>
                                Начать день
                            </button>
                            <button id="stopTimer" class="btn-secondary" onclick="stopTimer()" disabled>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <rect x="9" y="9" width="6" height="6"></rect>
                                </svg>
                                Завершить день
                            </button>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Текущий заработок</h3>
                            <span id="currentEarnings">0 ₽</span>
                        </div>
                        <div class="stat-card">
                            <h3>Отработанно сегодня</h3>
                            <span id="todayTime">00:00:00</span>
                        </div>
                    </div>

                    <!-- Навигация внизу раздела -->
                    <div class="app-nav">
                        <button class="nav-btn" onclick="showSection('timerSection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            Таймер
                        </button>
                        <button class="nav-btn" onclick="showSection('rateSection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                            Ставка
                        </button>
                        <button class="nav-btn" onclick="showSection('historySection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                            История
                        </button>
                        <button class="nav-btn" onclick="showSection('syncSection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 0 1 9-9"></path>
                            </svg>
                            Синхронизация
                        </button>
                    </div>
                </section>

                <!-- Настройки почасовой ставки -->
                <section class="rate-section hidden" id="rateSection">
                    <h2>Почасовая ставка</h2>
                    <div class="rate-card">
                        <input type="number" id="hourlyRate" placeholder="Почасовая ставка (₽)">
                        <button class="btn-primary" onclick="updateHourlyRate()">Сохранить</button>
                    </div>

                    <!-- Навигация внизу раздела -->
                    <div class="app-nav">
                        <button class="nav-btn" onclick="showSection('timerSection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            Таймер
                        </button>
                        <button class="nav-btn" onclick="showSection('rateSection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                            Ставка
                        </button>
                        <button class="nav-btn" onclick="showSection('historySection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                            История
                        </button>
                        <button class="nav-btn" onclick="showSection('syncSection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 0 1 9-9"></path>
                            </svg>
                            Синхронизация
                        </button>
                    </div>
                </section>

                <!-- История и статистика -->
                <section class="history-section hidden" id="historySection">
                    <h2>История работы</h2>
                    <div class="history-filters">
                        <input type="date" id="startDate">
                        <span>по</span>
                        <input type="date" id="endDate">
                        <button class="btn-primary" onclick="filterHistory()">Фильтровать</button>
                        <button class="btn-secondary" onclick="exportToPDF()">Экспорт в PDF</button>
                    </div>
                    <div class="history-list" id="historyList">
                        <!-- История будет загружена здесь -->
                    </div>
                    <div class="history-stats">
                        <h3>Статистика</h3>
                        <div id="historyStats">
                            <!-- Статистика будет загружена здесь -->
                        </div>
                    </div>

                    <!-- Навигация внизу раздела -->
                    <div class="app-nav">
                        <button class="nav-btn" onclick="showSection('timerSection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            Таймер
                        </button>
                        <button class="nav-btn" onclick="showSection('rateSection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                            Ставка
                        </button>
                        <button class="nav-btn" onclick="showSection('historySection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                            История
                        </button>
                        <button class="nav-btn" onclick="showSection('syncSection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 0 1 9-9"></path>
                            </svg>
                            Синхронизация
                        </button>
                    </div>
                </section>

                <!-- Синхронизация данных -->
                <section class="sync-section hidden" id="syncSection">
                    <h2>Синхронизация данных</h2>
                    <p>Для синхронизации данных между устройствами используйте функции экспорта и импорта.</p>
                    
                    <div class="sync-controls">
                        <button class="btn-primary" onclick="exportData()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Экспорт данных
                        </button>
                        <button class="btn-secondary" onclick="document.getElementById('importFile').click()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            Импорт данных
                        </button>
                        <input type="file" id="importFile" style="display: none" accept=".json" onchange="importData(event)">
                    </div>

                    <div class="sync-status" id="syncStatus" style="margin-top: 20px; padding: 10px; background: white; border-radius: var(--border-radius);">
                        <p>Статус: Данные не синхронизированы</p>
                    </div>

                    <!-- Навигация внизу раздела -->
                    <div class="app-nav">
                        <button class="nav-btn" onclick="showSection('timerSection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            Таймер
                        </button>
                        <button class="nav-btn" onclick="showSection('rateSection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                            Ставка
                        </button>
                        <button class="nav-btn" onclick="showSection('historySection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                            История
                        </button>
                        <button class="nav-btn" onclick="showSection('syncSection')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 0 1 9-9"></path>
                            </svg>
                            Синхронизация
                        </button>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        // Константы и переменные
        const PASSWORD = "aplanta10";
        let timerInterval = null;
        let startTime = null;
        let elapsedTime = 0;
        let isTimerRunning = false;

        // Элементы интерфейса
        const authScreen = document.getElementById('authScreen');
        const appContainer = document.getElementById('appContainer');
        const passwordInput = document.getElementById('passwordInput');
        const currentTimerElement = document.getElementById('currentTimer');
        const currentEarningsElement = document.getElementById('currentEarnings');
        const todayTimeElement = document.getElementById('todayTime');
        const startButton = document.getElementById('startTimer');
        const stopButton = document.getElementById('stopTimer');
        const syncStatus = document.getElementById('syncStatus');

        // Функция входа
        function login() {
            if (passwordInput.value === PASSWORD) {
                authScreen.style.display = 'none';
                appContainer.style.display = 'flex';
                loadUserData();
            } else {
                alert('Неверный пароль. Попробуйте снова.');
                passwordInput.value = '';
            }
        }

        // Функция выхода
        function logout() {
            if (isTimerRunning) {
                if (!confirm('Таймер все еще работает. Вы уверены, что хотите выйти?')) {
                    return;
                }
                stopTimer();
            }
            
            authScreen.style.display = 'flex';
            appContainer.style.display = 'none';
            passwordInput.value = '';
        }

        // Функция перехода на главную
        function goToHome() {
            showSection('timerSection');
        }

        // Запуск таймера
        function startTimer() {
            if (isTimerRunning) return;
            
            startTime = new Date();
            isTimerRunning = true;
            
            // Обновляем UI
            startButton.disabled = true;
            stopButton.disabled = false;
            
            // Запускаем интервал обновления времени
            timerInterval = setInterval(updateTimer, 1000);
            
            // Сохраняем время начала
            localStorage.setItem('timerStartTime', startTime.toISOString());
        }

        // Остановка таймера
        function stopTimer() {
            if (!isTimerRunning) return;
            
            clearInterval(timerInterval);
            isTimerRunning = false;
            
            // Обновляем UI
            startButton.disabled = false;
            stopButton.disabled = true;
            
            // Сохраняем сеанс работы
            saveWorkSession();
            
            // Сбрасываем таймер
            currentTimerElement.textContent = '00:00:00';
            elapsedTime = 0;
            
            // Удаляем время начала из localStorage
            localStorage.removeItem('timerStartTime');
        }

        // Обновление отображения таймера
        function updateTimer() {
            const now = new Date();
            elapsedTime = Math.floor((now - startTime) / 1000);
            
            const hours = Math.floor(elapsedTime / 3600);
            const minutes = Math.floor((elapsedTime % 3600) / 60);
            const seconds = elapsedTime % 60;
            
            currentTimerElement.textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Обновляем текущий заработок
            updateCurrentEarnings();
        }

        // Обновление текущего заработка
        function updateCurrentEarnings() {
            const hourlyRate = parseFloat(localStorage.getItem('hourlyRate')) || 0;
            if (hourlyRate > 0) {
                const earnings = (elapsedTime / 3600) * hourlyRate;
                currentEarningsElement.textContent = `${earnings.toFixed(2)} ₽`;
            }
        }

        // Сохранение сеанса работы
        function saveWorkSession() {
            const endTime = new Date();
            const duration = elapsedTime;
            const hourlyRate = parseFloat(localStorage.getItem('hourlyRate')) || 0;
            const earnings = (duration / 3600) * hourlyRate;
            
            // Создаем объект сеанса
            const session = {
                date: startTime.toISOString().split('T')[0],
                startTime: startTime.toISOString(),
                endTime: endTime.toISOString(),
                duration: duration,
                earnings: earnings
            };
            
            // Получаем существующую историю
            let workHistory = JSON.parse(localStorage.getItem('workHistory')) || [];
            
            // Добавляем новый сеанс
            workHistory.push(session);
            
            // Сохраняем обновленную историю
            localStorage.setItem('workHistory', JSON.stringify(workHistory));
            
            // Обновляем статистику
            updateStats();
            loadHistory();
        }

        // Обновление статистики
        function updateStats() {
            const workHistory = JSON.parse(localStorage.getItem('workHistory')) || [];
            const today = new Date().toISOString().split('T')[0];
            
            // Фильтруем сеансы за сегодня
            const todaySessions = workHistory.filter(session => session.date === today);
            
            // Считаем общее время за сегодня
            const totalSecondsToday = todaySessions.reduce((total, session) => total + session.duration, 0);
            
            const hoursToday = Math.floor(totalSecondsToday / 3600);
            const minutesToday = Math.floor((totalSecondsToday % 3600) / 60);
            const secondsToday = totalSecondsToday % 60;
            
            todayTimeElement.textContent = 
                `${hoursToday.toString().padStart(2, '0')}:${minutesToday.toString().padStart(2, '0')}:${secondsToday.toString().padStart(2, '0')}`;
        }

        // Обновление почасовой ставки
        function updateHourlyRate() {
            const hourlyRateInput = document.getElementById('hourlyRate');
            const rate = parseFloat(hourlyRateInput.value);
            
            if (!isNaN(rate) && rate >= 0) {
                localStorage.setItem('hourlyRate', rate.toString());
                alert('Почасовая ставка сохранена!');
                
                // Обновляем текущий заработок, если таймер работает
                if (isTimerRunning) {
                    updateCurrentEarnings();
                }
                
                // Обновляем историю, чтобы пересчитать заработок
                loadHistory();
            } else {
                alert('Пожалуйста, введите корректное значение для почасовой ставки.');
            }
        }

        // Загрузка истории работы
        function loadHistory() {
            const historyList = document.getElementById('historyList');
            const workHistory = JSON.parse(localStorage.getItem('workHistory')) || [];
            
            if (workHistory.length === 0) {
                historyList.innerHTML = '<p>История работы отсутствует.</p>';
                updateHistoryStats(workHistory);
                return;
            }
            
            // Сортируем историю по дате (новые first)
            workHistory.sort((a, b) => new Date(b.startTime) - new Date(a.startTime));
            
            let historyHTML = '';
            workHistory.forEach(session => {
                const date = new Date(session.startTime);
                const startTime = new Date(session.startTime);
                const endTime = new Date(session.endTime);
                
                const hours = Math.floor(session.duration / 3600);
                const minutes = Math.floor((session.duration % 3600) / 60);
                
                historyHTML += `
                    <div class="history-item">
                        <div class="history-date">${date.toLocaleDateString()}</div>
                        <div class="history-time">${startTime.toLocaleTimeString()} - ${endTime.toLocaleTimeString()}</div>
                        <div class="history-duration">${hours}ч ${minutes}м</div>
                        <div class="history-earnings">${session.earnings.toFixed(2)} ₽</div>
                    </div>
                `;
            });
            
            historyList.innerHTML = historyHTML;
            updateHistoryStats(workHistory);
        }

        // Обновление статистики истории
        function updateHistoryStats(workHistory) {
            const historyStats = document.getElementById('historyStats');
            
            if (workHistory.length === 0) {
                historyStats.innerHTML = '<p>Нет данных для отображения статистики.</p>';
                return;
            }
            
            // Вычисляем общую статистику
            const totalHours = workHistory.reduce((total, session) => total + (session.duration / 3600), 0);
            const totalEarnings = workHistory.reduce((total, session) => total + session.earnings, 0);
            const averageEarnings = totalEarnings / workHistory.length;
            
            // Находим самый длинный рабочий день
            const longestSession = workHistory.reduce((longest, session) => {
                return session.duration > longest.duration ? session : longest;
            }, workHistory[0]);
            
            historyStats.innerHTML = `
                <div class="stat-item">
                    <span>Общее время:</span>
                    <span>${totalHours.toFixed(2)} часов</span>
                </div>
                <div class="stat-item">
                    <span>Общий заработок:</span>
                    <span>${totalEarnings.toFixed(2)} ₽</span>
                </div>
                <div class="stat-item">
                    <span>Средний заработок:</span>
                    <span>${averageEarnings.toFixed(2)} ₽ за сеанс</span>
                </div>
                <div class="stat-item">
                    <span>Самый длинный сеанс:</span>
                    <span>${Math.floor(longestSession.duration / 3600)}ч ${Math.floor((longestSession.duration % 3600) / 60)}м</span>
                </div>
            `;
        }

        // Фильтрация истории
        function filterHistory() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            
            if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                alert('Пожалуйста, выберите корректные даты для фильтрации');
                return;
            }
            
            const workHistory = JSON.parse(localStorage.getItem('workHistory')) || [];
            const filteredHistory = workHistory.filter(session => {
                const sessionDate = new Date(session.date);
                return sessionDate >= startDate && sessionDate <= endDate;
            });
            
            const historyList = document.getElementById('historyList');
            
            if (filteredHistory.length === 0) {
                historyList.innerHTML = '<p>Нет данных за выбранный период.</p>';
                updateHistoryStats(filteredHistory);
                return;
            }
            
            let historyHTML = '';
            filteredHistory.forEach(session => {
                const date = new Date(session.startTime);
                const startTime = new Date(session.startTime);
                const endTime = new Date(session.endTime);
                
                const hours = Math.floor(session.duration / 3600);
                const minutes = Math.floor((session.duration % 3600) / 60);
                
                historyHTML += `
                    <div class="history-item">
                        <div class="history-date">${date.toLocaleDateString()}</div>
                        <div class="history-time">${startTime.toLocaleTimeString()} - ${endTime.toLocaleTimeString()}</div>
                        <div class="history-duration">${hours}ч ${minutes}м</div>
                        <div class="history-earnings">${session.earnings.toFixed(2)} ₽</div>
                    </div>
                `;
            });
            
            historyList.innerHTML = historyHTML;
            updateHistoryStats(filteredHistory);
        }

        // Экспорт в PDF
        function exportToPDF() {
            // В реальном приложении здесь бы реализовали экспорт в PDF
            alert('Экспорт в PDF будет реализован в следующей версии');
        }

        // Экспорт данных
        function exportData() {
            const data = {
                workHistory: JSON.parse(localStorage.getItem('workHistory') || '[]'),
                hourlyRate: localStorage.getItem('hourlyRate') || '',
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `a-planta-timer-backup-${new Date().toISOString().slice(0, 10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            syncStatus.innerHTML = '<p>Статус: Данные успешно экспортированы</p>';
        }

        // Импорт данных
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.workHistory) {
                        localStorage.setItem('workHistory', JSON.stringify(data.workHistory));
                    }
                    
                    if (data.hourlyRate) {
                        localStorage.setItem('hourlyRate', data.hourlyRate);
                        document.getElementById('hourlyRate').value = data.hourlyRate;
                    }
                    
                    // Обновляем интерфейс
                    loadHistory();
                    updateStats();
                    
                    syncStatus.innerHTML = '<p>Статус: Данные успешно импортированы</p>';
                    alert('Данные успешно импортированы!');
                } catch (error) {
                    syncStatus.innerHTML = '<p>Статус: Ошибка импорта данных</p>';
                    alert('Ошибка при импорте данных. Убедитесь, что файл имеет правильный формат.');
                }
            };
            reader.readAsText(file);
        }

        // Показать определенную секцию
        function showSection(sectionId) {
            // Скрываем все секции
            document.querySelectorAll('section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Показываем выбранную секцию
            document.getElementById(sectionId).classList.remove('hidden');
        }

        // Загрузка данных пользователя
        function loadUserData() {
            // Загружаем почасовую ставку
            const hourlyRate = localStorage.getItem('hourlyRate') || '';
            document.getElementById('hourlyRate').value = hourlyRate;
            
            // Загружаем историю работы
            loadHistory();
            
            // Обновляем статистику
            updateStats();
            
            // Восстанавливаем таймер, если он был запущен
            restoreTimer();
        }

        // Восстановление таймера при перезагрузке страницы
        function restoreTimer() {
            const savedStartTime = localStorage.getItem('timerStartTime');
            if (savedStartTime) {
                startTime = new Date(savedStartTime);
                isTimerRunning = true;
                
                // Обновляем UI
                startButton.disabled = true;
                stopButton.disabled = false;
                
                // Запускаем интервал
                timerInterval = setInterval(updateTimer, 1000);
            }
        }

        // Обработка нажатия Enter в поле пароля
        passwordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            // Устанавливаем текущие даты в фильтры
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            
            document.getElementById('startDate').valueAsDate = firstDay;
            document.getElementById('endDate').valueAsDate = today;
            
            // Проверяем, есть ли ранее сохраненные данные
            if (localStorage.getItem('workHistory')) {
                syncStatus.innerHTML = '<p>Статус: Локальные данные загружены</p>';
            }
        });
    </script>
</body>
</html>